class t{constructor(e,i,s){this.gl=e;const n=t.compileShader(e,e.VERTEX_SHADER,i),r=t.compileShader(e,e.FRAGMENT_SHADER,s);this.glProgram=t.createProgram(e,n,r),this.uniforms=this._getActiveUniforms()}use(){this.gl.useProgram(this.glProgram)}setUniform(t,e){const i=this.uniforms[t];if(i)return i.setter(i.location,e)}_getActiveUniforms(){const t={},e=this.gl.getProgramParameter(this.glProgram,this.gl.ACTIVE_UNIFORMS);for(let i=0;i<e;i++){const e=this.gl.getActiveUniform(this.glProgram,i);t[e.name]={location:this.gl.getUniformLocation(this.glProgram,e.name),setter:this._getUniformSetter(e.type),type:e.type}}return t}_getUniformSetter(t){switch(t){case this.gl.FLOAT:return(t,e)=>{this.gl.uniform1f(t,e)};case this.gl.FLOAT_VEC2:return(t,e)=>{this.gl.uniform2fv(t,e)};case this.gl.FLOAT_VEC3:return(t,e)=>{this.gl.uniform3fv(t,e)};case this.gl.FLOAT_VEC4:return(t,e)=>{this.gl.uniform4fv(t,e)};case this.gl.INT:case this.gl.BOOL:case this.gl.UNSIGNED_INT:case this.gl.SAMPLER_2D:return(t,e)=>{this.gl.uniform1i(t,e)};case this.gl.INT_VEC2:case this.gl.BOOL_VEC2:case this.gl.UNSIGNED_INT_VEC2:return(t,e)=>{this.gl.uniform2iv(t,e)};case this.gl.INT_VEC3:case this.gl.BOOL_VEC3:case this.gl.UNSIGNED_INT_VEC3:return(t,e)=>{this.gl.uniform3iv(t,e)};case this.gl.INT_VEC4:case this.gl.BOOL_VEC4:case this.gl.UNSIGNED_INT_VEC4:return(t,e)=>{this.gl.uniform4iv(t,e)};case this.gl.FLOAT_MAT2:return(t,e)=>{this.gl.uniformMatrix2fv(t,!1,e)};case this.gl.FLOAT_MAT3:return(t,e)=>{this.gl.uniformMatrix3fv(t,!1,e)};case this.gl.FLOAT_MAT4:return(t,e)=>{this.gl.uniformMatrix4fv(t,!1,e)}}}static compileShader(t,e,i){const s=t.createShader(e);return t.shaderSource(s,i),t.compileShader(s),s}static createProgram(t,e,i){const s=t.createProgram();t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s);return t.getProgramParameter(s,t.LINK_STATUS)?s:(console.error(`Program linking failed: ${t.getProgramInfoLog(s)}`),console.error(`Vertex shader info log: ${t.getShaderInfoLog(e)}`),console.error(`Fragment shader info log: ${t.getShaderInfoLog(i)}`),t.deleteShader(e),t.deleteShader(i),void t.deleteProgram(s))}}class e{constructor(t,{width:e=512,height:i=512,internalformat:s=t.RGBA,format:n=t.RGBA,type:r=t.UNSIGNED_BYTE,data:o=null,minFilter:h=t.LINEAR,magFilter:a=t.LINEAR,wrapMode:c=t.CLAMP_TO_EDGE}={}){this.gl=t,this.width=e,this.height=i,this.internalformat=s,this.format=n,this.type=r,this.glTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.glTexture),t.texImage2D(t.TEXTURE_2D,0,s,e,i,0,n,r,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,c),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,c)}bind(t=0){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.glTexture)}resize(t,e){this.width=t,this.height=e,this.gl.bindTexture(this.gl.TEXTURE_2D,this.glTexture),this.gl.texImage2D(gl.TEXTURE_2D,0,this.internalformat,t,e,0,this.format,this.type,null)}}class i{constructor(t,{width:e=1024,height:i=1024,format:s=t.DEPTH_COMPONENT24}={}){const n=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,n),t.renderbufferStorage(t.RENDERBUFFER,s,e,i)}bind(){this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.glRenderbuffer)}}class s{constructor(t,e,i,...s){this.gl=t,this.width=e,this.height=i,this.glFramebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.glFramebuffer);for(const e of s)e.texture instanceof WebGLRenderbuffer?t.framebufferRenderbuffer(t.FRAMEBUFFER,e.type,t.RENDERBUFFER,e.texture):t.framebufferTexture2D(t.FRAMEBUFFER,e.type,t.TEXTURE_2D,e.texture,e.level||0)}bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glFramebuffer),this.gl.viewport(0,0,this.width,this.height)}resize(t,e){this.width=t,this.height=e}}class n{constructor(t){this.gl=t,this.vao=t.createVertexArray(),this.mode=t.TRIANGLES,this.count=0,this.attributes={}}setAttribute(t,{data:e,dataType:i,count:s,byteCount:n,usage:r=this.gl.STATIC_DRAW}){const o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,r),this.attributes[t]={data:e,dataType:i,count:s,buffer:o}}bindAttributes(t){this.bind();for(const e in this.attributes){const i=this.attributes[e],s=this.gl.getAttribLocation(t.glProgram,e);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i.buffer),this.gl.vertexAttribPointer(s,i.count,i.dataType,!1,0,0),this.gl.enableVertexAttribArray(s)}}bind(){this.gl.bindVertexArray(this.vao)}setDrawMode(t,e){this.mode=t,this.count=e}draw(){this.bind(),this.gl.drawArrays(this.mode,0,this.count)}static createQuadMesh(t,e){const i=new n(t);return i.setDrawMode(t.TRIANGLE_FAN,4),i.setAttribute("aPosition",{data:new Float32Array([-1,-1,-1,1,1,1,1,-1]),dataType:t.FLOAT,count:2}),i.setAttribute("aUv",{data:new Float32Array([0,0,0,1,1,1,1,0]),dataType:t.FLOAT,count:2}),i.bindAttributes(e),i}static createFullscreenMesh(t,e){const i=new n(t);return i.setDrawMode(t.TRIANGLES,3),i.setAttribute("aPosition",{data:new Float32Array([-1,-1,-1,3,3,-1]),dataType:t.FLOAT,count:2}),i.setAttribute("aUv",{data:new Float32Array([0,0,0,2,2,0]),dataType:t.FLOAT,count:2}),i.bindAttributes(e),i}}class r{constructor(t){this.domElement=t,this.x=0,this.y=0,this.prevX=0,this.prevY=0,this.scroll=0,this.isPressed=!1,this.buttonLeft=!1,this.buttonRight=!1,this._addEventListeners()}_addEventListeners(){this.domElement.addEventListener("mousemove",this._mouseMoved.bind(this)),this.domElement.addEventListener("touchmove",this._mouseMoved.bind(this),{passive:!0}),this.domElement.addEventListener("mousedown",this._mousePressed.bind(this)),this.domElement.addEventListener("touchstart",this._mousePressed.bind(this),{passive:!0}),this.domElement.addEventListener("mouseup",this._mouseReleased.bind(this)),this.domElement.addEventListener("touchend",this._mouseReleased.bind(this)),this.domElement.addEventListener("mouseleave",this._mouseReleased.bind(this)),this.domElement.addEventListener("touchleave",this._mouseReleased.bind(this)),this.domElement.addEventListener("wheel",this._mouseScrolled.bind(this),{passive:!0})}_mouseMoved(t){let e=null!=t.clientX?t.clientX:t.touches[0].clientX,i=null!=t.clientY?t.clientY:t.touches[0].clientY,s=this.domElement.getBoundingClientRect();this.prevX=this.x,this.prevY=this.y,this.x=e-s.left,this.y=i-s.top}_mousePressed(t){let e=null!=t.clientX?t.clientX:t.touches[0].clientX,i=null!=t.clientY?t.clientY:t.touches[0].clientY,s=this.domElement.getBoundingClientRect();this.x=e-s.left,this.y=i-s.top,this.prevX=this.x,this.prevY=this.y,this.isPressed=!0,0==t.button&&(this.buttonLeft=!0),2==t.button&&(this.buttonRight=!0),t.touches&&t.touches.length>1&&(this.buttonRight=!0)}_mouseReleased(t){this.pressed=!1,this.buttonLeft=!1,this.buttonRight=!1}_mouseScrolled(t){this.scroll=t.deltaY}}class o{constructor(t){this.domElement=t,this.keys={},this._addEventListeners()}_addEventListeners(){this.domElement.addEventListener("keydown",this._keyPressed.bind(this)),this.domElement.addEventListener("keyup",this._keyReleased.bind(this))}_setInputs(t,e){switch(t.keyCode){case 37:case 65:this.left=e;break;case 39:case 68:this.right=e;break;case 38:case 87:this.up=e;break;case 40:case 83:this.down=e;break;case 32:this.space=e;break;case 16:this.shift=e;break;case 81:this.q=e;break;case 69:this.e=e;break;case 17:this.ctrl=e;break;case 67:this.c=e}}_keyPressed(t){this._setInputs(t,!0)}_keyReleased(t){this._setInputs(t,!1)}}var h=function(){var t=0,e=document.createElement("div");function i(t){return e.appendChild(t.dom),t}function s(i){for(var s=0;s<e.children.length;s++)e.children[s].style.display=s===i?"block":"none";t=i}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",(function(i){i.preventDefault(),s(++t%e.children.length)}),!1);var n=(performance||Date).now(),r=n,o=0,a=i(new h.Panel("FPS","#0ff","#002")),c=i(new h.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=i(new h.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:e,addPanel:i,showPanel:s,begin:function(){n=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(c.update(t-n,200),t>=r+1e3&&(a.update(1e3*o/(t-r),100),r=t,o=0,u)){var e=performance.memory;u.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){n=this.end()},domElement:e,setMode:s}};h.Panel=function(t,e,i){var s=1/0,n=0,r=Math.round,o=r(window.devicePixelRatio||1),h=80*o,a=48*o,c=3*o,u=2*o,l=3*o,d=15*o,m=74*o,f=30*o,p=document.createElement("canvas");p.width=h,p.height=a,p.style.cssText="width:80px;height:48px";var g=p.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,h,a),g.fillStyle=e,g.fillText(t,c,u),g.fillRect(l,d,m,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(l,d,m,f),{dom:p,update:function(a,E){s=Math.min(s,a),n=Math.max(n,a),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,h,d),g.fillStyle=e,g.fillText(r(a)+" "+t+" ("+r(s)+"-"+r(n)+")",c,u),g.drawImage(p,l+o,d,m-o,f,l,d,m-o,f),g.fillRect(l+m-o,d,o,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(l+m-o,d,o,r((1-a/E)*f))}}};const a={resizeCanvasToDisplaySize:function(t,e){e=e||1;const i=t.clientWidth*e|0,s=t.clientHeight*e|0;return(t.width!==i||t.height!==s)&&(t.width=i,t.height=s,!0)},disableContextMenu:function(t){t.addEventListener("contextmenu",(t=>{2==t.button&&t.preventDefault()}))},addStatsJS:function(t=0,e=document.body){const i=new h;i.showPanel(t),e.appendChild(i.dom),requestAnimationFrame((function t(){i.update(),requestAnimationFrame(t)}))}};function c(t,e){return[Math.cos(e)*Math.cos(t),Math.sin(t),Math.sin(e)*Math.cos(t)]}function u(t,e){return t-e*Math.floor(t/e)}function l(t,e,i){return Math.min(Math.max(t,e),i)}const d={pitchYawToDirection:c,mod:u,fract:function(t){return t-Math.floor(t)},clamp:l},m=function(){let t=Float32Array;function e(e,i,s){return(s=s||new t(3))[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],s}function i(e,i){i=i||new t(3);var s=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return s>1e-5&&(i[0]=e[0]/s,i[1]=e[1]/s,i[2]=e[2]/s),i}function s(e,i,s){return(s=s||new t(3))[0]=e[1]*i[2]-e[2]*i[1],s[1]=e[2]*i[0]-e[0]*i[2],s[2]=e[0]*i[1]-e[1]*i[0],s}function n(t,e){const i=t[0]-e[0],s=t[1]-e[1],n=t[2]-e[2];return i*i+s*s+n*n}function r(e,i){i=i||new t(16);var s=e[0],n=e[1],r=e[2],o=e[3],h=e[4],a=e[5],c=e[6],u=e[7],l=e[8],d=e[9],m=e[10],f=e[11],p=e[12],g=e[13],E=e[14],v=e[15],y=m*v,b=E*f,R=c*v,w=E*u,T=c*f,M=m*u,_=r*v,I=E*o,A=r*f,L=m*o,S=r*u,F=c*o,P=l*g,x=p*d,V=h*g,D=p*a,U=h*d,N=l*a,k=s*g,X=p*n,B=s*d,C=l*n,O=s*a,Y=h*n,q=y*a+w*d+T*g-(b*a+R*d+M*g),G=b*n+_*d+L*g-(y*n+I*d+A*g),z=R*n+I*a+S*g-(w*n+_*a+F*g),H=M*n+A*a+F*d-(T*n+L*a+S*d),W=1/(s*q+h*G+l*z+p*H);return i[0]=W*q,i[1]=W*G,i[2]=W*z,i[3]=W*H,i[4]=W*(b*h+R*l+M*p-(y*h+w*l+T*p)),i[5]=W*(y*s+I*l+A*p-(b*s+_*l+L*p)),i[6]=W*(w*s+_*h+F*p-(R*s+I*h+S*p)),i[7]=W*(T*s+L*h+S*l-(M*s+A*h+F*l)),i[8]=W*(P*u+D*f+U*v-(x*u+V*f+N*v)),i[9]=W*(x*o+k*f+C*v-(P*o+X*f+B*v)),i[10]=W*(V*o+X*u+O*v-(D*o+k*u+Y*v)),i[11]=W*(N*o+B*u+Y*f-(U*o+C*u+O*f)),i[12]=W*(V*m+N*E+x*c-(U*E+P*c+D*m)),i[13]=W*(B*E+P*r+X*m-(k*m+C*E+x*r)),i[14]=W*(k*c+Y*E+D*r-(O*E+V*r+X*c)),i[15]=W*(O*m+U*r+C*c-(B*c+Y*m+N*r)),i}return{copy:function(e,i){return(i=i||new t(16))[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},lookAt:function(n,r,o,h){h=h||new t(16);var a=i(e(n,r)),c=i(s(o,a)),u=i(s(a,c));return h[0]=c[0],h[1]=c[1],h[2]=c[2],h[3]=0,h[4]=u[0],h[5]=u[1],h[6]=u[2],h[7]=0,h[8]=a[0],h[9]=a[1],h[10]=a[2],h[11]=0,h[12]=n[0],h[13]=n[1],h[14]=n[2],h[15]=1,h},addVectors:function(e,i,s){return(s=s||new t(3))[0]=e[0]+i[0],s[1]=e[1]+i[1],s[2]=e[2]+i[2],s},subtractVectors:e,scaleVector:function(e,i,s){return(s=s||new t(3))[0]=e[0]*i,s[1]=e[1]*i,s[2]=e[2]*i,s},distance:function(t,e){return Math.sqrt(n(t,e))},distanceSq:n,normalize:i,compose:function(e,i,s,n){n=n||new t(16);const r=i[0],o=i[1],h=i[2],a=i[3],c=r+r,u=o+o,l=h+h,d=r*c,m=r*u,f=r*l,p=o*u,g=o*l,E=h*l,v=a*c,y=a*u,b=a*l,R=s[0],w=s[1],T=s[2];return n[0]=(1-(p+E))*R,n[1]=(m+b)*R,n[2]=(f-y)*R,n[3]=0,n[4]=(m-b)*w,n[5]=(1-(d+E))*w,n[6]=(g+v)*w,n[7]=0,n[8]=(f+y)*T,n[9]=(g-v)*T,n[10]=(1-(d+p))*T,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n},cross:s,decompose:function(t,e,i,s){let n=m.length(t.slice(0,3));const r=m.length(t.slice(4,7)),o=m.length(t.slice(8,11));var h,a,c,u,l,d,f,p,g,E,v,y,b,R,w,T,M,_,I,A,L,S,F,P,x,V,D,U,N;(a=(h=t)[0],c=h[1],u=h[2],l=h[3],d=h[4],f=h[5],p=h[6],g=h[7],E=h[8],v=h[9],y=h[10],b=h[11],R=h[12],w=h[13],T=h[14],M=h[15],1/(a*((_=y*M)*f+(L=T*g)*v+(S=p*b)*w-((I=T*b)*f+(A=p*M)*v+(F=y*g)*w))+d*(I*c+(P=u*M)*v+(D=y*l)*w-(_*c+(x=T*l)*v+(V=u*b)*w))+E*(A*c+x*f+(U=u*g)*w-(L*c+P*f+(N=p*l)*w))+R*(F*c+V*f+N*v-(S*c+D*f+U*v))))<0&&(n=-n),e[0]=t[12],e[1]=t[13],e[2]=t[14];const k=m.copy(t),X=1/n,B=1/r,C=1/o;k[0]*=X,k[1]*=X,k[2]*=X,k[4]*=B,k[5]*=B,k[6]*=B,k[8]*=C,k[9]*=C,k[10]*=C,function(t,e){const i=t[0],s=t[4],n=t[8],r=t[1],o=t[5],h=t[9],a=t[2],c=t[6],u=t[10],l=i+o+u;if(l>0){const t=.5/Math.sqrt(l+1);e[3]=.25/t,e[0]=(c-h)*t,e[1]=(n-a)*t,e[2]=(r-s)*t}else if(i>o&&i>u){const t=2*Math.sqrt(1+i-o-u);e[3]=(c-h)/t,e[0]=.25*t,e[1]=(s+r)/t,e[2]=(n+a)/t}else if(o>u){const t=2*Math.sqrt(1+o-i-u);e[3]=(n-a)/t,e[0]=(s+r)/t,e[1]=.25*t,e[2]=(h+c)/t}else{const t=2*Math.sqrt(1+u-i-o);e[3]=(r-s)/t,e[0]=(n+a)/t,e[1]=(h+c)/t,e[2]=.25*t}}(k,i),s[0]=n,s[1]=r,s[2]=o},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},identity:function(e){return(e=e||new t(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,i){return(i=i||new t(16))[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15],i},length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},lengthSq:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},orthographic:function(e,i,s,n,r,o,h){return(h=h||new t(16))[0]=2/(i-e),h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2/(n-s),h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2/(r-o),h[11]=0,h[12]=(e+i)/(e-i),h[13]=(s+n)/(s-n),h[14]=(r+o)/(r-o),h[15]=1,h},frustum:function(e,i,s,n,r,o,h){var a=i-e,c=n-s,u=o-r;return(h=h||new t(16))[0]=2*r/a,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2*r/c,h[6]=0,h[7]=0,h[8]=(e+i)/a,h[9]=(n+s)/c,h[10]=-(o+r)/u,h[11]=-1,h[12]=0,h[13]=0,h[14]=-2*r*o/u,h[15]=0,h},perspective:function(e,i,s,n,r){r=r||new t(16);var o=Math.tan(.5*Math.PI-.5*e),h=1/(s-n);return r[0]=o/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=(s+n)*h,r[11]=-1,r[12]=0,r[13]=0,r[14]=s*n*h*2,r[15]=0,r},translation:function(e,i,s,n){return(n=n||new t(16))[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e,n[13]=i,n[14]=s,n[15]=1,n},translate:function(e,i,s,n,r){r=r||new t(16);var o=e[0],h=e[1],a=e[2],c=e[3],u=e[4],l=e[5],d=e[6],m=e[7],f=e[8],p=e[9],g=e[10],E=e[11],v=e[12],y=e[13],b=e[14],R=e[15];return e!==r&&(r[0]=o,r[1]=h,r[2]=a,r[3]=c,r[4]=u,r[5]=l,r[6]=d,r[7]=m,r[8]=f,r[9]=p,r[10]=g,r[11]=E),r[12]=o*i+u*s+f*n+v,r[13]=h*i+l*s+p*n+y,r[14]=a*i+d*s+g*n+b,r[15]=c*i+m*s+E*n+R,r},xRotation:function(e,i){i=i||new t(16);var s=Math.cos(e),n=Math.sin(e);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=n,i[7]=0,i[8]=0,i[9]=-n,i[10]=s,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},yRotation:function(e,i){i=i||new t(16);var s=Math.cos(e),n=Math.sin(e);return i[0]=s,i[1]=0,i[2]=-n,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=n,i[9]=0,i[10]=s,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},zRotation:function(e,i){i=i||new t(16);var s=Math.cos(e),n=Math.sin(e);return i[0]=s,i[1]=n,i[2]=0,i[3]=0,i[4]=-n,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},xRotate:function(e,i,s){s=s||new t(16);var n=e[4],r=e[5],o=e[6],h=e[7],a=e[8],c=e[9],u=e[10],l=e[11],d=Math.cos(i),m=Math.sin(i);return s[4]=d*n+m*a,s[5]=d*r+m*c,s[6]=d*o+m*u,s[7]=d*h+m*l,s[8]=d*a-m*n,s[9]=d*c-m*r,s[10]=d*u-m*o,s[11]=d*l-m*h,e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s},yRotate:function(e,i,s){s=s||new t(16);var n=e[0],r=e[1],o=e[2],h=e[3],a=e[8],c=e[9],u=e[10],l=e[11],d=Math.cos(i),m=Math.sin(i);return s[0]=d*n-m*a,s[1]=d*r-m*c,s[2]=d*o-m*u,s[3]=d*h-m*l,s[8]=d*a+m*n,s[9]=d*c+m*r,s[10]=d*u+m*o,s[11]=d*l+m*h,e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s},zRotate:function(e,i,s){s=s||new t(16);var n=e[0],r=e[1],o=e[2],h=e[3],a=e[4],c=e[5],u=e[6],l=e[7],d=Math.cos(i),m=Math.sin(i);return s[0]=d*n+m*a,s[1]=d*r+m*c,s[2]=d*o+m*u,s[3]=d*h+m*l,s[4]=d*a-m*n,s[5]=d*c-m*r,s[6]=d*u-m*o,s[7]=d*l-m*h,e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s},axisRotation:function(e,i,s){s=s||new t(16);var n=e[0],r=e[1],o=e[2],h=Math.sqrt(n*n+r*r+o*o),a=(n/=h)*n,c=(r/=h)*r,u=(o/=h)*o,l=Math.cos(i),d=Math.sin(i),m=1-l;return s[0]=a+(1-a)*l,s[1]=n*r*m+o*d,s[2]=n*o*m-r*d,s[3]=0,s[4]=n*r*m-o*d,s[5]=c+(1-c)*l,s[6]=r*o*m+n*d,s[7]=0,s[8]=n*o*m+r*d,s[9]=r*o*m-n*d,s[10]=u+(1-u)*l,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},axisRotate:function(e,i,s,n){n=n||new t(16);var r=i[0],o=i[1],h=i[2],a=Math.sqrt(r*r+o*o+h*h),c=(r/=a)*r,u=(o/=a)*o,l=(h/=a)*h,d=Math.cos(s),m=Math.sin(s),f=1-d,p=c+(1-c)*d,g=r*o*f+h*m,E=r*h*f-o*m,v=r*o*f-h*m,y=u+(1-u)*d,b=o*h*f+r*m,R=r*h*f+o*m,w=o*h*f-r*m,T=l+(1-l)*d,M=e[0],_=e[1],I=e[2],A=e[3],L=e[4],S=e[5],F=e[6],P=e[7],x=e[8],V=e[9],D=e[10],U=e[11];return n[0]=p*M+g*L+E*x,n[1]=p*_+g*S+E*V,n[2]=p*I+g*F+E*D,n[3]=p*A+g*P+E*U,n[4]=v*M+y*L+b*x,n[5]=v*_+y*S+b*V,n[6]=v*I+y*F+b*D,n[7]=v*A+y*P+b*U,n[8]=R*M+w*L+T*x,n[9]=R*_+w*S+T*V,n[10]=R*I+w*F+T*D,n[11]=R*A+w*P+T*U,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},scaling:function(e,i,s,n){return(n=n||new t(16))[0]=e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},scale:function(e,i,s,n,r){return(r=r||new t(16))[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r[3]=i*e[3],r[4]=s*e[4],r[5]=s*e[5],r[6]=s*e[6],r[7]=s*e[7],r[8]=n*e[8],r[9]=n*e[9],r[10]=n*e[10],r[11]=n*e[11],e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},multiply:function(e,i,s){s=s||new t(16);var n=i[0],r=i[1],o=i[2],h=i[3],a=i[4],c=i[5],u=i[6],l=i[7],d=i[8],m=i[9],f=i[10],p=i[11],g=i[12],E=i[13],v=i[14],y=i[15],b=e[0],R=e[1],w=e[2],T=e[3],M=e[4],_=e[5],I=e[6],A=e[7],L=e[8],S=e[9],F=e[10],P=e[11],x=e[12],V=e[13],D=e[14],U=e[15];return s[0]=n*b+r*M+o*L+h*x,s[1]=n*R+r*_+o*S+h*V,s[2]=n*w+r*I+o*F+h*D,s[3]=n*T+r*A+o*P+h*U,s[4]=a*b+c*M+u*L+l*x,s[5]=a*R+c*_+u*S+l*V,s[6]=a*w+c*I+u*F+l*D,s[7]=a*T+c*A+u*P+l*U,s[8]=d*b+m*M+f*L+p*x,s[9]=d*R+m*_+f*S+p*V,s[10]=d*w+m*I+f*F+p*D,s[11]=d*T+m*A+f*P+p*U,s[12]=g*b+E*M+v*L+y*x,s[13]=g*R+E*_+v*S+y*V,s[14]=g*w+E*I+v*F+y*D,s[15]=g*T+E*A+v*P+y*U,s},inverse:r,transformVector:function(e,i,s){s=s||new t(4);for(var n=0;n<4;++n){s[n]=0;for(var r=0;r<4;++r)s[n]+=i[r]*e[4*r+n]}return s},transformPoint:function(e,i,s){s=s||new t(3);var n=i[0],r=i[1],o=i[2],h=n*e[3]+r*e[7]+o*e[11]+e[15];return s[0]=(n*e[0]+r*e[4]+o*e[8]+e[12])/h,s[1]=(n*e[1]+r*e[5]+o*e[9]+e[13])/h,s[2]=(n*e[2]+r*e[6]+o*e[10]+e[14])/h,s},transformDirection:function(e,i,s){s=s||new t(3);var n=i[0],r=i[1],o=i[2];return s[0]=n*e[0]+r*e[4]+o*e[8],s[1]=n*e[1]+r*e[5]+o*e[9],s[2]=n*e[2]+r*e[6]+o*e[10],s},transformNormal:function(e,i,s){s=s||new t(3);var n=r(e),o=i[0],h=i[1],a=i[2];return s[0]=o*n[0]+h*n[1]+a*n[2],s[1]=o*n[4]+h*n[5]+a*n[6],s[2]=o*n[8]+h*n[9]+a*n[10],s},setDefaultType:function(e){const i=t;return t=e,i}}}();class f{constructor(t,e){this.mouseInput=t,this.domElement=e,this.pitch=0,this.yaw=0,this.pitchVelocity=0,this.yawVelocity=0,this.radius=1,this.radiusVelocity=0,this.damping=.75,this.radiusDamping=.6,this.direction=[0,0,1],this.origin=[0,0,0],this.position=[0,0,0],this.scrollSensitivity=2,this.panSensitivity=5,this._addEventListeners()}update(){Math.abs(this.pitchVelocity)>1e-4&&(this.pitch+=this.pitchVelocity,this.pitch=l(this.pitch,.5*-Math.PI+1e-4,.5*Math.PI-1e-4),this.pitchVelocity*=this.damping),Math.abs(this.yawVelocity)>1e-4&&(this.yaw+=this.yawVelocity,this.yaw=u(this.yaw,2*Math.PI),this.yawVelocity*=this.damping),Math.abs(this.radiusVelocity)>1e-4&&(this.radius+=this.radiusVelocity,this.radiusVelocity*=this.radiusDamping),this.direction=c(this.pitch,this.yaw),m.scaleVector(this.direction,this.radius,this.position),m.addVectors(this.position,this.origin,this.position)}_addEventListeners(){this.domElement.addEventListener("mousemove",this._mouseMoved.bind(this)),this.domElement.addEventListener("touchmove",this._mouseMoved.bind(this),{passive:!0}),this.domElement.addEventListener("wheel",this._mouseScrolled.bind(this),{passive:!0})}_mouseMoved(t){if(this.mouseInput.x!=this.mouseInput.prevX||this.mouseInput.y!=this.mouseInput.prevY)if(this.mouseInput.buttonLeft){let t=(this.mouseInput.x-this.mouseInput.prevX)/this.domElement.clientWidth,e=(this.mouseInput.y-this.mouseInput.prevY)/this.domElement.clientHeight;this.pitchVelocity+=e*Math.PI/3,this.yawVelocity+=t*Math.PI*2/3}else if(this.mouseInput.buttonRight){let t=m.normalize(m.cross([0,1,0],this.direction)),e=m.normalize(m.cross(this.direction,t)),i=this.panSensitivity*(this.mouseInput.x-this.mouseInput.prevX)/this.domElement.clientHeight,s=this.panSensitivity*-(this.mouseInput.y-this.mouseInput.prevY)/this.domElement.clientHeight;this.origin[0]-=t[0]*i+e[0]*s,this.origin[1]-=t[1]*i+e[1]*s,this.origin[2]-=t[2]*i+e[2]*s}}_mouseScrolled(t){this.radiusVelocity+=this.scrollSensitivity*t.deltaY/1e3}}class p{constructor(t,e,i){this.mouseInput=t,this.keyInput=e,this.domElement=i,this.pitch=0,this.yaw=0,this.pitchVelocity=0,this.yawVelocity=0,this.damping=0,this.direction=[0,0,1],this.directionRight=[-1,0,0],this.origin=[0,0,0],this.position=[0,0,0],this.lookSensitivity=1,this.speed=1,this.speedupScale=2,this._addEventListeners()}update(){let t=this.speed,e=this.speed,i=this.speed;this.keyInput.shift&&(t*=this.speedupScale,e*=this.speedupScale,i*=this.speedupScale),this.keyInput.space&&(this.position[1]+=e),this.keyInput.c&&(this.position[1]-=e),(this.keyInput.up||this.keyInput.down)&&(this.keyInput.down&&(t=-t),m.addVectors(this.position,m.scaleVector(this.direction,t),this.position)),(this.keyInput.left||this.keyInput.right)&&(this.keyInput.left&&(i=-i),m.addVectors(this.position,m.scaleVector(this.directionRight,i),this.position)),Math.abs(this.pitchVelocity)>1e-4&&(this.pitch+=this.pitchVelocity,this.pitch=l(this.pitch,.5*-Math.PI+1e-4,.5*Math.PI-1e-4),this.pitchVelocity*=this.damping),Math.abs(this.yawVelocity)>1e-4&&(this.yaw+=this.yawVelocity,this.yaw=u(this.yaw,2*Math.PI),this.yawVelocity*=this.damping),Math.abs(this.radiusVelocity)>1e-4&&(this.radius+=this.radiusVelocity,this.radiusVelocity*=this.radiusDamping),this.direction=c(this.pitch,this.yaw),this.directionRight=m.normalize(m.cross(this.direction,[0,1,0])),m.addVectors(this.position,this.direction,this.origin)}_addEventListeners(){this.domElement.addEventListener("mousemove",this._mouseMoved.bind(this)),this.domElement.addEventListener("touchmove",this._mouseMoved.bind(this),{passive:!0})}_mouseMoved(t){if((this.mouseInput.x!=this.mouseInput.prevX||this.mouseInput.y!=this.mouseInput.prevY)&&this.mouseInput.buttonLeft){let t=this.lookSensitivity*(this.mouseInput.x-this.mouseInput.prevX)/this.domElement.clientWidth,e=this.lookSensitivity*(this.mouseInput.y-this.mouseInput.prevY)/this.domElement.clientHeight;this.pitchVelocity-=e*Math.PI,this.yawVelocity+=t*Math.PI*2}}}export{p as FPSControls,s as Framebuffer,o as KeyInput,d as MathUtils,n as Mesh,r as MouseInput,f as OrbitControls,i as Renderbuffer,t as ShaderProgram,e as Texture,a as Utils};
